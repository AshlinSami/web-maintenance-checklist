<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Maintenance Checklist</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background-color: #2c5aa0;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .info-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
        }
        .info-item {
            display: flex;
            flex-direction: column;
        }
        .info-item label {
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 5px;
        }
        .info-item input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .section {
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
        }
        .section-header {
            background-color: #4CAF50;
            color: white;
            padding: 12px 15px;
            font-weight: bold;
            font-size: 16px;
        }
        .section-content {
            padding: 15px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 5px;
        }
        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .checkbox-item label {
            font-weight: bold;
            margin-right: 10px;
        }
        .checkbox-item input[type="text"], .checkbox-item select {
            margin-left: 10px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .plugin-table input[type="text"] {
            width: 100%;
            padding: 5px;
            border: none;
            background: transparent;
        }
        .plugin-table input[type="text"]:focus {
            background-color: #f0f8ff;
            outline: 1px solid #2c5aa0;
        }
        .status-success {
            color: #28a745;
            font-weight: bold;
        }
        .status-issue {
            color: #dc3545;
            font-weight: bold;
        }
        .notes-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .notes-section textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }
        .signature-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
        }
        @media print {
            body { 
                background-color: white; 
                margin: 0;
                padding: 20px;
                font-size: 12px;
                line-height: 1.4;
            }
            .container { 
                box-shadow: none; 
                max-width: none;
                margin: 0;
                padding: 0;
            }
            .submit-buttons { display: none !important; }
            button { display: none !important; }
            
            /* Hide Monday Task Verification section for clients */
            .monday-tasks-internal { display: none !important; }
            
            /* Hide Completed by / Signature section for clients */
            .signature-section { display: none !important; }
            
            /* Hide any URLs or links including GitHub form link */
            a[href]:after { content: none !important; }
            a { display: none !important; }
            
            /* Hide page URLs that browsers add */
            @page {
                margin: 1in;
                @bottom-center {
                    content: none;
                }
                @bottom-left {
                    content: none;
                }
                @bottom-right {
                    content: none;
                }
            }
            
            /* Professional page formatting */
            .header {
                text-align: center;
                margin-bottom: 30px;
                page-break-after: avoid;
            }
            
            .info-section {
                margin-bottom: 25px;
                page-break-after: avoid;
                border: 1px solid #ddd;
                padding: 15px;
                border-radius: 5px;
            }
            
            .section {
                margin-bottom: 20px;
                page-break-inside: avoid;
                border: 1px solid #e9ecef;
                padding: 15px;
            }
            
            .section-header {
                background-color: #f8f9fa !important;
                color: #333 !important;
                padding: 10px 15px;
                border-bottom: 2px solid #2c5aa0;
                font-weight: bold;
                margin: -15px -15px 15px -15px;
            }
            
            /* Table formatting for print */
            table {
                width: 100%;
                border-collapse: collapse;
                margin: 10px 0;
                page-break-inside: avoid;
            }
            
            th, td {
                border: 1px solid #333;
                padding: 8px;
                text-align: left;
                font-size: 11px;
            }
            
            th {
                background-color: #f5f5f5 !important;
                font-weight: bold;
            }
            
            /* Checkbox formatting */
            .checkbox-item {
                margin: 8px 0;
                display: flex;
                align-items: center;
            }
            
            /* Notes section */
            .notes-section {
                page-break-inside: avoid;
                border: 1px solid #ddd;
                padding: 15px;
                margin-top: 20px;
            }
            
            .notes-section textarea {
                border: none;
                background: transparent;
                width: 100%;
                font-family: inherit;
            }
            
            /* Page breaks */
            .page-break { page-break-before: always; }
            
            /* Remove shadows and unnecessary styling */
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* Hide any footer content that might contain links */
            footer, .footer { display: none !important; }
            
            /* Remove any auto-generated content */
            *:after, *:before {
                content: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">WEB MAINTENANCE CHECKLIST</div>
        
        <div class="info-section">
            <div class="info-item">
                <label>Date:</label>
                <input type="date" id="date">
            </div>
            <div class="info-item">
                <label>Specialist:</label>
                <select id="specialist">
                    <option value="">Select specialist</option>
                    <option value="Jason">Jason</option>
                    <option value="Ashlin">Ashlin</option>
                    <option value="Luke">Luke</option>
                </select>
            </div>
            <div class="info-item">
                <label>Website(s):</label>
                <input type="text" placeholder="Enter website URL(s)">
            </div>
        </div>

        <div class="section">
            <div class="section-header">1. BACKUP VERIFICATION</div>
            <div class="section-content">
                <div class="checkbox-item">
                    <input type="checkbox" id="backup-created">
                    <label>Complete backup file created</label>
                </div>
                <div class="checkbox-item">
                    <label>Backup location:</label>
                    <input type="text" placeholder="Enter backup location">
                </div>
                <div class="checkbox-item">
                    <label>Backup size:</label>
                    <input type="text" placeholder="Enter backup size">
                </div>
                <div class="checkbox-item">
                    <label>Backup type:</label>
                    <select>
                        <option>Select type</option>
                        <option>Full</option>
                        <option>Incremental</option>
                        <option>Database Only</option>
                    </select>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="backup-integrity">
                    <label>Backup integrity verified</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="backup-secure">
                    <label>Backup stored securely</label>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">2. PLUGIN MANAGEMENT</div>
            <div class="section-content">
                <h4>Plugins Successfully Updated:</h4>
                <div style="margin-bottom: 10px;">
                    <button type="button" onclick="addSuccessRow()" style="background-color: #28a745; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer;">+ Add Plugin Row</button>
                </div>
                <table class="plugin-table" id="success-table">
                    <thead>
                        <tr>
                            <th>Plugin Name</th>
                            <th>Current Version</th>
                            <th>New Version</th>
                            <th>Update Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><input type="text" placeholder="Plugin name" onchange="updatePluginCount()"></td><td><input type="text" placeholder="x.x.x"></td><td><input type="text" placeholder="x.x.x"></td><td class="status-success">✅ Success</td></tr>
                        <tr><td><input type="text" placeholder="Plugin name" onchange="updatePluginCount()"></td><td><input type="text" placeholder="x.x.x"></td><td><input type="text" placeholder="x.x.x"></td><td class="status-success">✅ Success</td></tr>
                        <tr><td><input type="text" placeholder="Plugin name" onchange="updatePluginCount()"></td><td><input type="text" placeholder="x.x.x"></td><td><input type="text" placeholder="x.x.x"></td><td class="status-success">✅ Success</td></tr>
                        <tr><td><input type="text" placeholder="Plugin name" onchange="updatePluginCount()"></td><td><input type="text" placeholder="x.x.x"></td><td><input type="text" placeholder="x.x.x"></td><td class="status-success">✅ Success</td></tr>
                        <tr><td><input type="text" placeholder="Plugin name" onchange="updatePluginCount()"></td><td><input type="text" placeholder="x.x.x"></td><td><input type="text" placeholder="x.x.x"></td><td class="status-success">✅ Success</td></tr>
                    </tbody>
                </table>

                <h4>Update Status - Unsuccessful:</h4>
                <div style="margin-bottom: 10px;">
                    <button type="button" onclick="addFailureRow()" style="background-color: #dc3545; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer;">+ Add Plugin Row</button>
                </div>
                <table class="plugin-table" id="failure-table">
                    <thead>
                        <tr>
                            <th>Plugin Name</th>
                            <th>Current Version</th>
                            <th>Reason Not Updated</th>
                            <th>Unsuccessful</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><input type="text" placeholder="Plugin name"></td><td><input type="text" placeholder="x.x.x"></td><td><input type="text" placeholder="Reason"></td><td class="status-issue">❌ Failed</td></tr>
                        <tr><td><input type="text" placeholder="Plugin name"></td><td><input type="text" placeholder="x.x.x"></td><td><input type="text" placeholder="Reason"></td><td class="status-issue">❌ Failed</td></tr>
                        <tr><td><input type="text" placeholder="Plugin name"></td><td><input type="text" placeholder="x.x.x"></td><td><input type="text" placeholder="Reason"></td><td class="status-issue">❌ Failed</td></tr>
                    </tbody>
                </table>
                
                <p><strong>Common reasons for update failures:</strong> Compatibility issues, Premium plugin requiring manual update, Plugin deprecated, Custom modifications, Client-specific requirements</p>
            </div>
        </div>

        <div class="section monday-tasks-internal">
            <div class="section-header">3. MONDAY TASK VERIFICATION</div>
            <div class="section-content">
                <div class="checkbox-item">
                    <input type="checkbox" id="monday-time">
                    <label>Time logged on Monday</label>
                    <input type="text" placeholder="Hours logged" style="width: 100px;">
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="monday-files">
                    <label>Required files attached on Monday</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="monday-comments">
                    <label>Comments added to Monday task</label>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">3. POST-MAINTENANCE VERIFICATION</div>
            <div class="section-content">
                <div class="checkbox-item">
                    <input type="checkbox" id="homepage-loads">
                    <label>Homepage loads correctly</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="key-pages">
                    <label>Key pages tested</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="contact-forms">
                    <label>Contact forms working</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="search-func">
                    <label>Search functionality working</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="mobile-responsive">
                    <label>Mobile responsiveness verified</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="load-speed">
                    <label>Page load speed acceptable</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="no-broken-links">
                    <label>No broken links detected</label>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">4. SECURITY</div>
            <div class="section-content">
                <div class="checkbox-item">
                    <input type="checkbox" id="security-plugin">
                    <label>Security plugin installed</label>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">5. DOCUMENTATION & REPORTING</div>
            <div class="section-content">
                <div class="checkbox-item">
                    <label>Total plugins updated:</label>
                    <input type="number" id="total-plugins" min="0" style="width: 80px;" readonly>
                    <span style="margin-left: 10px; font-style: italic; color: #666;">(Auto-calculated)</span>
                </div>
            </div>
        </div>

        <div class="notes-section">
            <label><strong>Notes/Additional Comments:</strong></label>
            <textarea placeholder="Enter any additional notes, issues encountered, or important observations..."></textarea>
        </div>

        <div class="signature-section">
            <div class="info-item">
                <label>Completed by:</label>
                <select id="completed-by">
                    <option value="">Select specialist</option>
                    <option value="Jason">Jason</option>
                    <option value="Ashlin">Ashlin</option>
                    <option value="Luke">Luke</option>
                </select>
            </div>
            <div class="info-item">
                <label>Date completed:</label>
                <input type="date" id="date-completed">
            </div>
            <div class="info-item">
                <label>Supervisor review:</label>
                <select id="supervisor-review">
                    <option value="To be reviewed" selected>To be reviewed</option>
                    <option value="Approved">Approved</option>
                    <option value="Needs revision">Needs revision</option>
                </select>
            </div>
        </div>

        <div class="submit-buttons" style="text-align: center; margin: 30px 0; padding: 20px; background-color: #f8f9fa; border-radius: 8px;">
            <h3 style="color: #2c5aa0; margin-bottom: 20px;">📄 SUBMIT COMPLETED CHECKLIST</h3>
            <button onclick="submitToManagement()" style="background-color: #28a745; color: white; padding: 15px 30px; border: none; border-radius: 5px; margin: 10px; cursor: pointer; font-size: 18px; font-weight: bold;">📧 Submit</button>
            <button onclick="exportToPDF()" style="background-color: #dc3545; color: white; padding: 15px 30px; border: none; border-radius: 5px; margin: 10px; cursor: pointer; font-size: 18px; font-weight: bold;">📋 Save as PDF</button>
            <br>
            <p style="color: #666; font-size: 14px; margin-top: 15px;">Submit will automatically email the completed checklist to management</p>
        </div>
    </div>

    <script>
        // EmailJS Configuration
        const EMAILJS_PUBLIC_KEY = 'FBMdsyoEoTdi6EcH-';
        const EMAILJS_SERVICE_ID = 'service_uug0tal';
        const EMAILJS_TEMPLATE_ID = 'template_eb9d8b7';
        const MANAGEMENT_EMAIL = 'ashlin@algorithm.agency';

        // CLIENT-SPECIFIC EMAIL ROUTING CONFIGURATION
        const CLIENT_ROUTING = {
            // Add your client websites here with their specific managers and CC lists
            'example-client1.com': {
                manager: 'manager1@algorithm.agency',
                cc: ['support1@algorithm.agency'],
                priority: 'high'
            },
            'example-client2.com': {
                manager: 'manager2@algorithm.agency',
                cc: ['support2@algorithm.agency', 'sales@algorithm.agency'],
                priority: 'medium'
            },
            'example-client3.com': {
                manager: 'manager3@algorithm.agency',
                cc: ['support3@algorithm.agency'],
                priority: 'standard'
            }
            // Add more clients as needed
        };

        // GOOGLE SHEETS ANALYTICS CONFIGURATION
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbzhvS621Ipue98_MnpYoJXWEGV8S-IGf7VtrurOwsrfpvnx7twpHupZgqn_22BEW78QdQ/exec';

        // Initialize EmailJS
        (function() {
            emailjs.init(EMAILJS_PUBLIC_KEY);
        })();

        // Function to detect client from website URL
        function getClientRouting(websiteUrl) {
            if (!websiteUrl) return null;
            
            // Clean the URL to get just the domain
            const cleanUrl = websiteUrl.toLowerCase()
                .replace(/^https?:\/\//, '')
                .replace(/^www\./, '')
                .split('/')[0];
            
            // Check if we have routing for this client
            for (const [clientDomain, routing] of Object.entries(CLIENT_ROUTING)) {
                if (cleanUrl.includes(clientDomain.toLowerCase())) {
                    return routing;
                }
            }
            
            // Default routing if client not found
            return {
                manager: MANAGEMENT_EMAIL,
                cc: [],
                priority: 'standard'
            };
        }

        // Function to log data to Google Sheets for analytics
        async function logToAnalytics(formData) {
            if (!GOOGLE_SHEETS_URL || GOOGLE_SHEETS_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                console.log('Google Sheets analytics not configured yet');
                return;
            }

            try {
                const response = await fetch(GOOGLE_SHEETS_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    console.log('Data logged to analytics successfully');
                } else {
                    console.error('Failed to log to analytics');
                }
            } catch (error) {
                console.error('Analytics logging error:', error);
            }
        }

        // Set today's date as default
        document.getElementById('date').valueAsDate = new Date();
        
        // Add some interactivity for better UX
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    this.parentElement.style.backgroundColor = '#e8f5e8';
                } else {
                    this.parentElement.style.backgroundColor = '';
                }
            });
        });

        // Main function to submit to management via EmailJS with client routing
        async function submitToManagement() {
            // Validate required fields
            const specialist = document.getElementById('specialist').value;
            const website = document.querySelector('input[placeholder="Enter website URL(s)"]').value;
            
            if (!specialist) {
                alert('⚠️ Please select a specialist before submitting.');
                return;
            }
            
            if (!website.trim()) {
                alert('⚠️ Please enter the website URL(s) before submitting.');
                return;
            }

            // Show loading state
            const submitBtn = event.target;
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '📤 Sending...';
            submitBtn.disabled = true;

            // Get client-specific routing
            const clientRouting = getClientRouting(website);
            
            // Generate detailed summary for management
            const emailContent = generateManagementSummary();
            
            // Collect analytics data
            const analyticsData = generateAnalyticsData();
            
            // Prepare email parameters with client routing
            const templateParams = {
                name: specialist,
                time: new Date().toLocaleString(),
                message: emailContent
            };

            // Determine recipients based on client routing
            let recipients = [clientRouting.manager];
            if (clientRouting.cc && clientRouting.cc.length > 0) {
                recipients = recipients.concat(clientRouting.cc);
            }

            // Log to analytics first
            try {
                await logToAnalytics(analyticsData);
            } catch (error) {
                console.error('Analytics logging failed:', error);
            }

            // Send email via EmailJS
            emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams)
                .then(function(response) {
                    console.log('Email sent successfully!', response.status, response.text);
                    
                    // Update completed by and date
                    document.getElementById('completed-by').value = specialist;
                    document.getElementById('date-completed').valueAsDate = new Date();
                    
                    // Success notification with client info
                    submitBtn.innerHTML = '✅ Sent Successfully!';
                    submitBtn.style.backgroundColor = '#28a745';
                    
                    const clientInfo = clientRouting.manager !== MANAGEMENT_EMAIL 
                        ? `\n📧 Sent to: ${clientRouting.manager}\n📋 CC'd: ${clientRouting.cc.join(', ')}`
                        : `\n📧 Sent to: ${MANAGEMENT_EMAIL}`;
                    
                    alert('✅ Checklist successfully submitted!\n\n' + 
                          `🎯 Priority: ${clientRouting.priority.toUpperCase()}` + 
                          clientInfo +
                          '\n📊 Data logged to analytics dashboard');
                    
                    // Reset button after 3 seconds
                    setTimeout(() => {
                        submitBtn.innerHTML = originalText;
                        submitBtn.style.backgroundColor = '#28a745';
                        submitBtn.disabled = false;
                    }, 3000);
                    
                }, function(error) {
                    console.error('Failed to send email:', error);
                    
                    // Error notification
                    submitBtn.innerHTML = '❌ Failed to Send';
                    submitBtn.style.backgroundColor = '#dc3545';
                    
                    alert('❌ Failed to send email.\n\nError: ' + error.text + '\n\nPlease try again or save as PDF instead.');
                    
                    // Reset button after 3 seconds
                    setTimeout(() => {
                        submitBtn.innerHTML = originalText;
                        submitBtn.style.backgroundColor = '#28a745';
                        submitBtn.disabled = false;
                    }, 3000);
                });
        }

        // Generate analytics data for dashboard
        function generateAnalyticsData() {
            const date = document.querySelector('input[type="date"]').value || new Date().toISOString().split('T')[0];
            const specialist = document.getElementById('specialist').value || 'Not specified';
            const website = document.querySelector('input[placeholder="Enter website URL(s)"]').value || 'Not specified';
            
            // Count completed tasks
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const totalTasks = checkboxes.length;
            const completedTasks = Array.from(checkboxes).filter(cb => cb.checked).length;
            const completionPercent = Math.round(completedTasks/totalTasks*100);
            
            // Count plugins
            const successTable = document.getElementById('success-table');
            const failureTable = document.getElementById('failure-table');
            
            let updatedPlugins = 0;
            let failedPlugins = 0;
            
            // Count successful updates
            const successRows = successTable.querySelectorAll('tbody tr');
            successRows.forEach(row => {
                const inputs = row.querySelectorAll('input[type="text"]');
                const pluginName = inputs[0].value.trim();
                if (pluginName) updatedPlugins++;
            });
            
            // Count failed updates
            const failureRows = failureTable.querySelectorAll('tbody tr');
            failureRows.forEach(row => {
                const inputs = row.querySelectorAll('input[type="text"]');
                const pluginName = inputs[0].value.trim();
                if (pluginName) failedPlugins++;
            });

            // Get client routing info
            const clientRouting = getClientRouting(website);
            
            // Check for critical issues
            const criticalIssues = [];
            if (!document.getElementById('backup-created').checked) criticalIssues.push('No Backup');
            if (!document.getElementById('backup-integrity').checked) criticalIssues.push('Backup Not Verified');
            if (!document.getElementById('security-plugin').checked) criticalIssues.push('No Security Plugin');
            if (failedPlugins > 0) criticalIssues.push(`${failedPlugins} Plugin Failures`);
            
            return {
                timestamp: new Date().toISOString(),
                date: date,
                specialist: specialist,
                website: website,
                clientManager: clientRouting.manager,
                clientPriority: clientRouting.priority,
                completionPercent: completionPercent,
                totalTasks: totalTasks,
                completedTasks: completedTasks,
                pluginsUpdated: updatedPlugins,
                pluginsFailed: failedPlugins,
                backupCreated: document.getElementById('backup-created').checked,
                backupVerified: document.getElementById('backup-integrity').checked,
                securityPlugin: document.getElementById('security-plugin').checked,
                mondayTimeLogged: document.getElementById('monday-time').checked,
                mondayFilesAttached: document.getElementById('monday-files').checked,
                mondayCommentsAdded: document.getElementById('monday-comments').checked,
                homepageFunctional: document.getElementById('homepage-loads').checked,
                mobileResponsive: document.getElementById('mobile-responsive').checked,
                noBrokenLinks: document.getElementById('no-broken-links').checked,
                criticalIssues: criticalIssues.join(', '),
                notes: document.querySelector('textarea').value || '',
                submissionTime: new Date().toLocaleString()
            };
        }

        // Generate comprehensive summary for management email
        function generateManagementSummary() {
            const date = document.querySelector('input[type="date"]').value || 'Not specified';
            const specialist = document.getElementById('specialist').value || 'Not specified';
            const website = document.querySelector('input[placeholder="Enter website URL(s)"]').value || 'Not specified';
            
            let summary = `WEB MAINTENANCE CHECKLIST - COMPLETED\n`;
            summary += `${'='.repeat(50)}\n\n`;
            summary += `Date: ${date}\n`;
            summary += `Specialist: ${specialist}\n`;
            summary += `Website(s): ${website}\n`;
            summary += `Submitted: ${new Date().toLocaleString()}\n\n`;

            // Count completed tasks
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const totalTasks = checkboxes.length;
            const completedTasks = Array.from(checkboxes).filter(cb => cb.checked).length;
            const completionPercent = Math.round(completedTasks/totalTasks*100);
            
            summary += `COMPLETION STATUS: ${completedTasks}/${totalTasks} tasks completed (${completionPercent}%)\n`;
            if (completionPercent === 100) {
                summary += `✅ ALL TASKS COMPLETED SUCCESSFULLY!\n\n`;
            } else {
                summary += `ATTENTION: ${totalTasks - completedTasks} tasks incomplete\n\n`;
            }

            // Backup section
            summary += `BACKUP VERIFICATION:\n`;
            summary += `   • Backup created: ${document.getElementById('backup-created').checked ? '✅ Yes' : '❌ No'}\n`;
            summary += `   • Integrity verified: ${document.getElementById('backup-integrity').checked ? '✅ Yes' : '❌ No'}\n\n`;

            // Plugin updates
            const successTable = document.getElementById('success-table');
            const failureTable = document.getElementById('failure-table');
            
            let updatedPlugins = [];
            let issuePlugins = [];
            
            // Get successful updates
            const successRows = successTable.querySelectorAll('tbody tr');
            successRows.forEach(row => {
                const inputs = row.querySelectorAll('input[type="text"]');
                const pluginName = inputs[0].value.trim();
                const currentVersion = inputs[1].value.trim();
                const newVersion = inputs[2].value.trim();
                if (pluginName) {
                    updatedPlugins.push(`${pluginName} (${currentVersion} → ${newVersion})`);
                }
            });
            
            // Get failed updates
            const failureRows = failureTable.querySelectorAll('tbody tr');
            failureRows.forEach(row => {
                const inputs = row.querySelectorAll('input[type="text"]');
                const pluginName = inputs[0].value.trim();
                const currentVersion = inputs[1].value.trim();
                const reason = inputs[2].value.trim();
                if (pluginName) {
                    issuePlugins.push(`${pluginName} (${currentVersion}) - ${reason}`);
                }
            });

            summary += `PLUGIN UPDATES:\n`;
            summary += `   • Successfully updated: ${updatedPlugins.length}\n`;
            if (updatedPlugins.length > 0) {
                updatedPlugins.forEach(plugin => summary += `     - ${plugin}\n`);
            }
            summary += `   • Issues/Not updated: ${issuePlugins.length}\n`;
            if (issuePlugins.length > 0) {
                issuePlugins.forEach(plugin => summary += `     - ${plugin}\n`);
            }
            summary += `\n`;

            // Monday tasks
            summary += `MONDAY TASK VERIFICATION:\n`;
            summary += `   • Time logged: ${document.getElementById('monday-time').checked ? '✅ Yes' : '❌ No'}\n`;
            summary += `   • Files attached: ${document.getElementById('monday-files').checked ? '✅ Yes' : '❌ No'}\n`;
            summary += `   • Comments added: ${document.getElementById('monday-comments').checked ? '✅ Yes' : '❌ No'}\n\n`;

            // Post-maintenance checks
            summary += `POST-MAINTENANCE VERIFICATION:\n`;
            summary += `   • Homepage functional: ${document.getElementById('homepage-loads').checked ? '✅ Yes' : '❌ No'}\n`;
            summary += `   • Key pages tested: ${document.getElementById('key-pages').checked ? '✅ Yes' : '❌ No'}\n`;
            summary += `   • Contact forms working: ${document.getElementById('contact-forms').checked ? '✅ Yes' : '❌ No'}\n`;
            summary += `   • Mobile responsive: ${document.getElementById('mobile-responsive').checked ? '✅ Yes' : '❌ No'}\n`;
            summary += `   • No broken links: ${document.getElementById('no-broken-links').checked ? '✅ Yes' : '❌ No'}\n\n`;

            // Security
            summary += `SECURITY CHECKS:\n`;
            summary += `   • Security plugin installed: ${document.getElementById('security-plugin').checked ? '✅ Yes' : '❌ No'}\n\n`;

            // Notes
            const notes = document.querySelector('textarea').value;
            if (notes.trim()) {
                summary += `ADDITIONAL NOTES:\n${notes}\n\n`;
            }

            // Highlight any issues
            const issues = [];
            if (!document.getElementById('backup-created').checked) issues.push('❌ Backup not created');
            if (!document.getElementById('backup-integrity').checked) issues.push('❌ Backup integrity not verified');
            if (issuePlugins.length > 0) issues.push(`WARNING: ${issuePlugins.length} plugins failed to update`);
            if (!document.getElementById('security-plugin').checked) issues.push('❌ Security plugin not installed');
            
            if (issues.length > 0) {
                summary += `ISSUES REQUIRING ATTENTION:\n`;
                issues.forEach(issue => summary += `   ${issue}\n`);
                summary += `\n`;
            }

            summary += `${'='.repeat(50)}\n`;
            summary += `This automated report was generated by the Web Maintenance Checklist system.\n`;
            summary += `For questions, contact ${specialist}.`;

            return summary;
        }

        // Function to add new rows for successful plugins
        function addSuccessRow() {
            const table = document.getElementById('success-table').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" placeholder="Plugin name" onchange="updatePluginCount()"></td>
                <td><input type="text" placeholder="x.x.x"></td>
                <td><input type="text" placeholder="x.x.x"></td>
                <td class="status-success">✅ Success</td>
            `;
        }

        // Function to add new rows for failed plugins
        function addFailureRow() {
            const table = document.getElementById('failure-table').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" placeholder="Plugin name"></td>
                <td><input type="text" placeholder="x.x.x"></td>
                <td><input type="text" placeholder="Reason"></td>
                <td class="status-issue">❌ Failed</td>
            `;
        }

        // Function to automatically count plugins
        function updatePluginCount() {
            const successTable = document.getElementById('success-table');
            const pluginNameInputs = successTable.querySelectorAll('tbody td:first-child input[type="text"]');
            let count = 0;
            
            pluginNameInputs.forEach(input => {
                if (input.value.trim() !== '') {
                    count++;
                }
            });
            
            document.getElementById('total-plugins').value = count;
        }

        // Initial count calculation
        setTimeout(updatePluginCount, 100);

        // Export functions (existing)
        function exportToPDF() {
            window.print();
            alert('💡 TIP: In the print dialog, select "Save as PDF" as your destination to create a PDF file.');
        }

        function generateSummary() {
            const date = document.querySelector('input[type="date"]').value || 'Not specified';
            const specialist = document.getElementById('specialist').value || 'Not specified';
            const website = document.querySelector('input[placeholder="Enter website URL(s)"]').value || 'Not specified';
            
            let summary = `WEB MAINTENANCE CHECKLIST SUMMARY\n`;
            summary += `==========================================\n`;
            summary += `Date: ${date}\n`;
            summary += `Specialist: ${specialist}\n`;
            summary += `Website(s): ${website}\n\n`;

            // Count completed tasks
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const totalTasks = checkboxes.length;
            const completedTasks = Array.from(checkboxes).filter(cb => cb.checked).length;
            
            summary += `COMPLETION STATUS: ${completedTasks}/${totalTasks} tasks completed (${Math.round(completedTasks/totalTasks*100)}%)\n\n`;

            // Backup section
            summary += `BACKUP VERIFICATION:\n`;
            summary += `- Backup created: ${document.getElementById('backup-created').checked ? '✅ Yes' : '❌ No'}\n`;
            summary += `- Integrity verified: ${document.getElementById('backup-integrity').checked ? '✅ Yes' : '❌ No'}\n\n`;

            // Plugin updates
            const successTable = document.getElementById('success-table');
            const failureTable = document.getElementById('failure-table');
            
            let updatedPlugins = [];
            let issuePlugins = [];
            
            // Get successful updates
            const successRows = successTable.querySelectorAll('tbody tr');
            successRows.forEach(row => {
                const inputs = row.querySelectorAll('input[type="text"]');
                const pluginName = inputs[0].value.trim();
                const currentVersion = inputs[1].value.trim();
                const newVersion = inputs[2].value.trim();
                if (pluginName) {
                    updatedPlugins.push(`${pluginName} (${currentVersion} → ${newVersion})`);
                }
            });
            
            // Get failed updates
            const failureRows = failureTable.querySelectorAll('tbody tr');
            failureRows.forEach(row => {
                const inputs = row.querySelectorAll('input[type="text"]');
                const pluginName = inputs[0].value.trim();
                const currentVersion = inputs[1].value.trim();
                const reason = inputs[2].value.trim();
                if (pluginName) {
                    issuePlugins.push(`${pluginName} (${currentVersion}) - ${reason}`);
                }
            });

            summary += `PLUGIN UPDATES:\n`;
            summary += `- Successfully updated: ${updatedPlugins.length}\n`;
            if (updatedPlugins.length > 0) {
                updatedPlugins.forEach(plugin => summary += `  • ${plugin}\n`);
            }
            summary += `- Issues/Not updated: ${issuePlugins.length}\n`;
            if (issuePlugins.length > 0) {
                issuePlugins.forEach(plugin => summary += `  • ${plugin}\n`);
            }
            summary += `\n`;

            // Monday tasks
            summary += `MONDAY TASK VERIFICATION:\n`;
            summary += `- Time logged: ${document.getElementById('monday-time').checked ? '✅ Yes' : '❌ No'}\n`;
            summary += `- Files attached: ${document.getElementById('monday-files').checked ? '✅ Yes' : '❌ No'}\n`;
            summary += `- Comments added: ${document.getElementById('monday-comments').checked ? '✅ Yes' : '❌ No'}\n\n`;

            // Post-maintenance checks
            summary += `POST-MAINTENANCE VERIFICATION:\n`;
            summary += `- Homepage functional: ${document.getElementById('homepage-loads').checked ? '✅ Yes' : '❌ No'}\n`;
            summary += `- Mobile responsive: ${document.getElementById('mobile-responsive').checked ? '✅ Yes' : '❌ No'}\n`;
            summary += `- No broken links: ${document.getElementById('no-broken-links').checked ? '✅ Yes' : '❌ No'}\n\n`;

            // Security
            summary += `SECURITY CHECKS:\n`;
            summary += `- Security plugin installed: ${document.getElementById('security-plugin').checked ? '✅ Yes' : '❌ No'}\n\n`;

            // Notes
            const notes = document.querySelector('textarea').value;
            if (notes.trim()) {
                summary += `ADDITIONAL NOTES:\n${notes}\n\n`;
            }

            summary += `==========================================\n`;
            summary += `Completed by: ${document.getElementById('completed-by').value || 'Not specified'}\n`;
            summary += `Date completed: ${document.getElementById('date-completed').value || 'Not specified'}\n`;
            summary += `Generated: ${new Date().toLocaleString()}\n`;

            return summary;
        }
    </script>
</body>
</html>
